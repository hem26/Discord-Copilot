# Discord Copilot

This project consists of an Admin Dashboard (built with Next.js) for configuring an AI-powered Discord Bot. It allows you to manage the bot's system instructions, specify which Discord channels it operates in, and reset its conversation memory.

## Features

*   **Admin Dashboard:**
    *   User authentication via Supabase.
    *   Configure bot's system instructions (personality).
    *   Manage allowed Discord channel IDs.
    *   Reset conversation memory for specific channels.
    *   Modern and aesthetic UI.
*   **Discord Bot:**
    *   AI-powered responses using Gemini API.
    *   Operates in configurable Discord channels.
    *   Maintains conversation memory per channel.
    *   Configurable system instructions.

## Project Structure

*   `/`: Next.js Admin Dashboard (frontend).
*   `discord-bot/`: Node.js Discord Bot (backend).

## Setup Instructions

Follow these steps to get the project up and running locally.

### 1. Database Setup (Supabase)

This project uses [Supabase](https://supabase.com/) for authentication, database, and storing bot configurations.

1.  **Create a Supabase Project:** Sign up or log in to Supabase and create a new project.
2.  **Get API Keys:** From your project settings, find your `Project URL` and `Anon Public` key.
3.  **Database Schema:** You'll need to set up the following tables in your Supabase project:

    *   **`agent_config` table:**
        ```sql
        CREATE TABLE public.agent_config (
            id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
            system_instructions text,
            created_at timestamp with time zone DEFAULT now() NOT NULL
        );
        ```
        *   _Note:_ This table should ideally contain only one row, updated as the global bot configuration.

    *   **`allowed_channels` table:**
        ```sql
        CREATE TABLE public.allowed_channels (
            id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
            channel_id text NOT NULL UNIQUE, -- Ensures no duplicate channel IDs
            created_at timestamp with time zone DEFAULT now() NOT NULL
        );
        ```
        *   _Note:_ This table will store each allowed Discord channel ID as a separate row.

    *   **`conversation_memory` table:**
        ```sql
        CREATE TABLE public.conversation_memory (
            id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
            discord_channel_id text NOT NULL UNIQUE, -- One memory per channel
            summary text,
            updated_at timestamp with time zone DEFAULT now() NOT NULL
        );
        ```
        *   _Note:_ This table stores the summarized conversation memory for each channel.

### 2. Configure Environment Variables

You need to create `.env` files for both the Next.js app and the Discord bot.

#### For the Next.js Admin Dashboard

Create a file named `.env.local` in the project's **root directory** (`/discord-copilot/`):

```env
NEXT_PUBLIC_SUPABASE_URL=YOUR_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
```

#### For the Discord Bot

Create a file named `.env` inside the `discord-bot/` directory (`/discord-copilot/discord-bot/`):

```env
DISCORD_TOKEN=YOUR_DISCORD_BOT_TOKEN
SUPABASE_URL=YOUR_SUPABASE_URL
SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
GEMINI_API_KEY=YOUR_GEMINI_API_KEY
GEMINI_API_URL=https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=YOUR_GEMINI_API_KEY
```

**Where to get these values:**

*   **`YOUR_SUPABASE_URL` / `YOUR_SUPABASE_ANON_KEY`**: From your Supabase Project Settings -> API.
*   **`YOUR_DISCORD_BOT_TOKEN`**: From the [Discord Developer Portal](https://discord.com/developers/applications). Create an application, then a Bot user, and generate a token. Remember to enable "Message Content Intent" for your bot under the Bot tab.
*   **`YOUR_GEMINI_API_KEY`**: From [Google AI Studio](https://makersuite.google.com/app/apikey).
*   **`GEMINI_API_URL`**: Use the provided default URL, replacing `YOUR_GEMINI_API_KEY` within it.

### 3. Install Dependencies

1.  **For the Next.js Admin Dashboard (in project root):**
    ```bash
    npm install
    ```
2.  **For the Discord Bot (in `discord-bot/` directory):**
    ```bash
    cd discord-bot/
    npm install
    cd ../
    ```

### 4. Running Locally

You will need two separate terminal windows.

1.  **Terminal 1: Start the Next.js Admin Dashboard**
    In the project's **root directory**, run:
    ```bash
    npm run dev
    ```
    Open your browser to `http://localhost:3000`.

2.  **Terminal 2: Start the Discord Bot**
    In the `discord-bot/` directory, run:
    ```bash
    cd discord-bot/
    npm start
    ```
    The bot should log "Logged in as <bot_name>!".

## Deployment

### Deploying the Admin Dashboard (Next.js) to Vercel

The Next.js admin dashboard is ready for deployment on [Vercel](https://vercel.com/).

1.  **Push to Git:** Ensure your project is pushed to a Git repository (GitHub, GitLab, Bitbucket).
2.  **Connect to Vercel:** Import your Git repository into Vercel. Vercel will automatically detect it's a Next.js project.
3.  **Configure Environment Variables:** In your Vercel project settings, go to "Environment Variables" and add your `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY`.
4.  **Deploy:** Vercel will build and deploy your application.

### Running the Discord Bot

The Discord bot needs to be run on a server that can stay online constantly. Options include:

*   **VPS (Virtual Private Server):** Deploy to a cloud server provider (e.g., AWS EC2, DigitalOcean, Linode).
*   **Heroku/Render/Fly.io:** Cloud platforms that support Node.js applications.
*   **Your Own Server:** Run it on a dedicated machine.

You would typically clone your repository to the server, navigate to the `discord-bot/` directory, install dependencies (`npm install`), configure its `.env` file, and then run it using a process manager like `PM2` to keep it online:

```bash
# Example for a server environment
cd /path/to/your/project/discord-bot/
npm install
# Ensure .env is configured on the server
pm2 start index.js --name "discord-copilot-bot"
pm2 save
```

---

## Testing

For detailed instructions on testing the full-stack functionality (configuring the bot via the dashboard, interacting in Discord, testing memory resets, etc.), please refer to the agent's previous conversation or the documentation of the specific features.